#!/usr/bin/env node

const { program } = require('commander');

const {
  ClusterCleanup,
  decorateClusterCleanup,
  setupCliOptions,
  buildClientConfigObject,
  generateCliList,
} = require('../dist');

const configuredParser = setupCliOptions(program);
configuredParser.parse();

const options = configuredParser.opts();

const { clusterName, stackName, verbose } = options;

const config = buildClientConfigObject(options);
const cleaner = decorateClusterCleanup(
  new ClusterCleanup(config),
  options.verbose
);

(async () => {
  const cleanedUp = cleaner.deleteClusterAndResources(
    clusterName,
    stackName,
    verbose
  );

  console.log(`Cleaned up the following resources`);
  console.log(generateCliList(cleanedUp));
})();
